<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“’ ê°€ê³„ë¶€ ì•±</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 30px auto; padding: 10px; }
    input, select, button { padding: 6px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f2f2f2; }
    .income { color: green; }
    .expense { color: red; }
  </style>
</head>
<body>

  <h2>ğŸ’° ê°€ê³„ë¶€ ì•±</h2>

  <div>
    <input type="text" id="desc" placeholder="í•­ëª© ì„¤ëª…">
    <input type="number" id="amount" placeholder="ê¸ˆì•¡">
    <select id="type">
      <option value="ìˆ˜ì…">ìˆ˜ì…</option>
      <option value="ì§€ì¶œ">ì§€ì¶œ</option>
    </select>
    <button id="addBtn">ì¶”ê°€</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>í•­ëª©</th>
        <th>ê¸ˆì•¡</th>
        <th>êµ¬ë¶„</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="listBody"></tbody>
  </table>

  <canvas id="statsChart" width="400" height="200"></canvas>

  <script>
    let ledger = JSON.parse(localStorage.getItem("ledger")) || [];

    function saveLedger() {
      localStorage.setItem("ledger", JSON.stringify(ledger));
    }

    function renderList() {
      const $body = $("#listBody");
      $body.empty();

      ledger.forEach((item, index) => {
        const row = `
          <tr>
            <td>${item.desc}</td>
            <td class="${item.type === 'ìˆ˜ì…' ? 'income' : 'expense'}">${item.amount.toLocaleString()} ì›</td>
            <td>${item.type}</td>
            <td><button class="delete" data-index="${index}">ì‚­ì œ</button></td>
          </tr>
        `;
        $body.append(row);
      });

      renderChart();
    }

    function renderChart() {
      const income = ledger.filter(item => item.type === 'ìˆ˜ì…')
                           .reduce((sum, i) => sum + i.amount, 0);
      const expense = ledger.filter(item => item.type === 'ì§€ì¶œ')
                            .reduce((sum, i) => sum + i.amount, 0);

      const ctx = document.getElementById('statsChart').getContext('2d');

      // ê¸°ì¡´ ì°¨íŠ¸ ì œê±° í›„ ìƒˆë¡œ ìƒì„±
      if (window.myChart) window.myChart.destroy();

      window.myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['ìˆ˜ì…', 'ì§€ì¶œ'],
          datasets: [{
            label: 'ê¸ˆì•¡',
            data: [income, expense],
            backgroundColor: ['#4caf50', '#f44336']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top'
            },
            title: {
              display: true,
              text: 'ìˆ˜ì…/ì§€ì¶œ í†µê³„'
            }
          }
        }
      });
    }

    $(document).ready(function () {
      renderList();

      $("#addBtn").click(function () {
        const desc = $("#desc").val().trim();
        const amount = parseInt($("#amount").val(), 10);
        const type = $("#type").val();

        if (!desc || isNaN(amount)) {
          alert("í•­ëª©ê³¼ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }

        ledger.push({ desc, amount, type });
        saveLedger();
        renderList();

        $("#desc").val("");
        $("#amount").val("");
      });

      $("#listBody").on("click", ".delete", function () {
        const index = $(this).data("index");
        ledger.splice(index, 1);
        saveLedger();
        renderList();
      });
    });
  </script>

</body>
</html>
