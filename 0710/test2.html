<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë‹¬ë ¥í˜• ì¶œì„ë¥  ê³„ì‚°ê¸°</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #e8f6ff;
    color: #333;
    padding: 30px;
    max-width: 800px;
    margin: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 165, 255, 0.2);
  }
  h2 {
    text-align: center;
    color: #007acc;
    margin-bottom: 20px;
  }
  label {
    font-weight: bold;
    color: #005b9f;
  }
  select, button.main-btn {
    padding: 8px 12px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    margin: 10px 0;
    background-color: #aee6ff;
    color: #003d66;
    transition: 0.2s;
  }
  button.main-btn:hover {
    background-color: #87d4f7;
    cursor: pointer;
  }
  table.calendar {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0,0,0,0.05);
    background: white;
  }
  table.calendar th, table.calendar td {
    border: 1px solid #b3e0ff;
    width: 14.28%;
    vertical-align: top;
    padding: 6px;
    height: 110px;
  }
  table.calendar th {
    background-color: #d6f1ff;
    color: #004d80;
    text-align: center;
  }
  .date-number {
    font-weight: bold;
    margin-bottom: 5px;
    color: #003d66;
  }
  .buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
  }
  .btn-attendance {
    flex: 1 1 30%;
    font-size: 12px;
    padding: 3px 0;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  .btn-attendance.A { background: #90ee90; }  /* ì—°í•œ ì´ˆë¡ - ì¶œì„ */
  .btn-attendance.X { background: #f08080; }  /* ì—°í•œ ë¹¨ê°• - ê²°ì„ */
  .btn-attendance.L { background: #ffd966; }  /* ì—°í•œ ë…¸ë‘ - ì§€ê° */
  .btn-attendance.E { background: #ffcc80; }  /* ì—°í•œ ì£¼í™© - ì¡°í‡´ */
  .btn-attendance.V { background: #add8e6; }  /* ì—°í•œ í•˜ëŠ˜ - íœ´ê°€ */
  .btn-attendance:hover {
    filter: brightness(90%);
  }
  .selected {
    box-shadow: 0 0 6px 3px #007acc99;
  }
  #resultArea {
    margin-top: 25px;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    font-size: 18px;
    color: #004d80;
  }
</style>
</head>
<body>

<h2>ğŸŒ¤ï¸ ë‹¬ë ¥í˜• ì¶œì„ë¥  ê³„ì‚°ê¸°</h2>

<label>âœ… ì›” ì„ íƒ: 
  <select id="monthSelect">
    <option value="6">6ì›”</option>
    <option value="7">7ì›”</option>
    <option value="8">8ì›”</option>
    <option value="9">9ì›”</option>
    <option value="10">10ì›”</option>
    <option value="11">11ì›”</option>
    <option value="12">12ì›”</option>
  </select>
</label>
<button class="main-btn" onclick="generateCalendar()">ğŸ“… ë‹¬ë ¥ ìƒì„±</button>
<button class="main-btn" onclick="calculateRate()">âœ… ì¶œì„ë¥  ê³„ì‚°</button>

<div id="calendarArea"></div>
<div id="resultArea"></div>

<script>
  const baseStart = new Date('2025-06-16');
  const baseEnd = new Date('2025-12-23');
  let attendanceData = {}; // ë‚ ì§œë³„ ì¶œê²° ìƒíƒœ ì €ì¥

  function isWeekday(date) {
    const day = date.getDay();
    return day !== 0 && day !== 6;
  }

  function getLastDateOfMonth(year, month) {
    return new Date(year, month + 1, 0).getDate();
  }

  function generateCalendar() {
    attendanceData = {}; // ì´ˆê¸°í™”
    const month = parseInt(document.getElementById('monthSelect').value);
    const year = 2025;
    const firstDay = new Date(year, month -1, 1);
    const lastDate = getLastDateOfMonth(year, month -1);
    const startDay = firstDay.getDay();

    let html = '<table class="calendar"><thead><tr>';
    const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    for(let d of weekDays){
      html += `<th>${d}</th>`;
    }
    html += '</tr></thead><tbody><tr>';

    for(let i=0; i < startDay; i++){
      html += '<td></td>';
    }

    for(let date=1; date<=lastDate; date++) {
      const currentDate = new Date(year, month -1, date);
      const dateStr = currentDate.toISOString().slice(0,10);

      if(currentDate < baseStart || currentDate > baseEnd){
        html += '<td style="background:#f0f4f8;"></td>';
      } else if(!isWeekday(currentDate)) {
        html += `<td style="background:#f0f4f8"><div class="date-number">${date}</div><small>ì£¼ë§</small></td>`;
      } else {
        html += `<td>
          <div class="date-number">${date}</div>
          <div class="buttons" data-date="${dateStr}">
            <button type="button" class="btn-attendance A" title="ì¶œì„" onclick="setAttendance('${dateStr}', 'A', this)">ì¶œì„</button>
            <button type="button" class="btn-attendance X" title="ê²°ì„" onclick="setAttendance('${dateStr}', 'X', this)">ê²°ì„</button>
            <button type="button" class="btn-attendance L" title="ì§€ê°" onclick="setAttendance('${dateStr}', 'L', this)">ì§€ê°</button>
            <button type="button" class="btn-attendance E" title="ì¡°í‡´" onclick="setAttendance('${dateStr}', 'E', this)">ì¡°í‡´</button>
            <button type="button" class="btn-attendance V" title="íœ´ê°€" onclick="setAttendance('${dateStr}', 'V', this)">íœ´ê°€</button>
          </div>
        </td>`;
      }

      if((startDay + date) % 7 === 0 && date !== lastDate){
        html += '</tr><tr>';
      }
    }

    const totalCells = startDay + lastDate;
    if(totalCells % 7 !== 0){
      const emptyCells = 7 - (totalCells % 7);
      for(let i=0; i<emptyCells; i++){
        html += '<td></td>';
      }
    }

    html += '</tr></tbody></table>';

    document.getElementById('calendarArea').innerHTML = html;
    document.getElementById('resultArea').innerHTML = '';
    attendanceData = {};
  }

  function setAttendance(dateStr, status, btn) {
    attendanceData[dateStr] = status;
    const container = btn.parentNode;
    const buttons = container.querySelectorAll('button');
    buttons.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
  }

  function calculateRate() {
    const month = parseInt(document.getElementById('monthSelect').value);
    const year = 2025;
    const lastDate = getLastDateOfMonth(year, month -1);

    let total = 0;
    let attended = 0;

    for(let date=1; date<=lastDate; date++){
      const currentDate = new Date(year, month -1, date);
      const dateStr = currentDate.toISOString().slice(0,10);

      if(currentDate < baseStart || currentDate > baseEnd) continue;
      if(!isWeekday(currentDate)) continue;

      const val = attendanceData[dateStr] || '';
      let penalty = 1;

      if(val === 'A') penalty = 0;
      else if(val === 'X') penalty = 1;
      else if(val === 'L' || val === 'E') penalty = 0.5;
      else if(val === 'V') penalty = 0;
      else penalty = 1;

      total++;
      attended += (1 - penalty);
    }

    const rate = total === 0 ? 0 : (attended / total) * 100;
    const passed = rate >= 80 ? 'âœ…' : 'âŒ';

    document.getElementById('resultArea').innerHTML = `
      <table>
        <tr><th>ì›”</th><th>ì¶œì„ì¼ìˆ˜</th><th>ì´ ìˆ˜ì—…ì¼ìˆ˜</th><th>ì¶œì„ë¥ </th><th>ë‹¬ì„±</th></tr>
        <tr><td>${month}ì›”</td><td>${attended.toFixed(1)}</td><td>${total}</td><td>${rate.toFixed(2)}%</td><td>${passed}</td></tr>
      </table>
    `;
  }
</script>

</body>
</html>
